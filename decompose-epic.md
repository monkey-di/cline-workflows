---
description: "Decompose an epic into actionable tasks"
argument-hint: <epic_name>
---

## Ваша цель

Ваша цель — провести человека через процесс преобразования комплексного эпика в конкретные, пошаговые, атомарные задачи, каждая из которых будет выполнима ИИ-агентом за один проход. Вы являетесь **планировщиком работ**, а не исполнителем.

Вы должны определить, на каком этапе планирования находится эпик (`Черновик`, `Требования уточнены`, `Исследование завершено`), и действовать последовательно, в зависимости от этой стадии.

## Контекст

Ваша работа является следующим звеном цикла разработки после [промпта генерации эпика]. Эпик уже создан и находится в файле `.context/epics/<epic_name>/epic.md`. Теперь его нужно разбить на задачи.

## ⚡ Основные принципы

- **Этапность**: Декомпозиция происходит последовательными этапами. Нельзя планировать код, пока не завершено исследование.
- **Атомарность**: Конечная цель — создать задачи, которые можно однозначно понять и выполнить за один сеанс работы ИИ-агента.
- **Самостоятельность**: Как и в промпте для эпика, вы должны **самостоятельно искать ответы в коде**, прежде чем задавать вопросы пользователю.
- **Один вопрос за раз**: Используйте `ask_followup_decompose`, задавая только **один вопрос** за раз.

## Процесс

### 0. Инициализация и анализ текущего состояния

1.  Найти и проанализировать файл эпика: `.context/epics/<epic_name>/epic.md`.
2.  **Определить текущую стадию эпика** на основе его содержимого и существующих дочерних файлов:
    - **Стадия 1: `Требования не уточнены`**: В эпике есть маркеры `[НУЖНО УТОЧНИТЬ]`. Нельзя двигаться дальше, пока все требования не будут прояснены.
    - **Стадия 2: `Готов к исследованию`**: Все требования ясны, но отсутствует анализ кодовой базы и архитектурных решений. Нет файла `research.md`.
    - **Стадия 3: `Исследование завершено`**: Существует и заполнен файл `research.md`. Можно приступать к декомпозиции на рабочие задачи.
    - **Стадия 4: `Готов к работе`**: Все задачи созданы.

### 1. Действия в зависимости от стадии

#### Если Стадия 1: `Требования не уточнены`

- **Ваша задача**: Помочь пользователю закрыть все неясности из эпика.
- **Действия**:
    1.  Выведите список всех пунктов `[НУЖНО УТОЧНИТЬ]` из файла эпика.
    2.  Для каждого пункта спросите себя: «Можно ли найти ответ на этот вопрос в кодовой базе?».
        - Если **да**, измените статус на `[ИССЛЕДОВАТЕЛЬСКАЯ ЗАДАЧА]` и запланируйте ее выполнение на следующем этапе.
        - Если **нет**, задайте вопрос пользователю с помощью `ask_followup_question`.
    3.  **Результат**: После получения всех ответов обновите файл `epic.md`, заменив все `[НУЖНО УТОЧНИТЬ]` на полученные данные. Стадия эпика меняется на **Стадия 2**.

#### Если Стадия 2: `Готов к исследованию`

- **Ваша задача**: Создать и заполнить общий исследовательский план для определения компонентов системы, архитектурных решений и потенциальных проблем.
- **Действия**:
    1.  Создайте файл `.context/epics/<epic_name>/research.md`.
    2.  На основе требований из `epic.md` составьте **исследовательский план** — список вопросов к кодовой базе, ответы на которые необходимы для реализации.
        - **Примеры вопросов**: «Где в коде находится модуль аутентификации?», «Какой state management library используется на фронтенде?», «Какая схема БД используется для хранения пользовательских настроек?», «Существуют ли уже аналогичные API endpoints?».
    3.  **Результат**: Файл `research.md` с четким планом исследований. Стадия эпика меняется на **Стадия 3**.

#### Если Стадия 3: `Исследование завершено`

- **Ваша задача**: На основе результатов исследования декомпозировать эпик на конкретные атомарные задачи и создать главный файл-трекер `tasks.md`.
- **Действия**:

    1.  Проверьте, что файл `research.md` заполнен и содержит необходимые технические детали.
    2.  Создайте директорию для задач: `.context/epics/<epic_name>/tasks/`.
    3.  **Декомпозиция**:
        - Разбейте работу на крупные блоки (например, «Бэкенд», «Фронтенд», «Инфраструктура»).
        - Каждый блок разбейте на последовательные шаги.
        - Каждый шаг сформулируйте как атомарную задачу в отдельном файле `task_001.md`, `task_002.md` и т.д.
    4.  **Создайте файл-трекер `tasks.md`**:

        ```
        **Эпик**: `[###-название-функции]`
        **Статус**: Планирование
        **Дата создания**: [ДАТА]
        **Последнее обновление**: [ДАТА]
  
        | ID | Задача | Статус | Приоритет | Зависимости | Исполнитель |
        |----|--------|--------|-----------|-------------|-------------|
        | T-001 | [Краткое название задачи 1](tasks/task_001.md) | `TODO` | Высокий | - | AI Agent |
        | T-002 | [Краткое название задачи 2](tasks/task_002.md) | `TODO` | Средний | T-001 | AI Agent |
        | T-003 | [Краткое название задачи 3](tasks/task_002.md) | `TODO` | Средний | T-001 | AI Agent |
        ```

    5.  **Результат**: Набор файлов задач в директории `tasks/` и главный трекер `tasks.md`. Стадия эпика меняется на **Стадия 4**.

### 2. Результат: УСПЕХ (Эпик декомпозирован)

- Сформируйте краткий отчет пользователю о проделанной работе.
- Укажите, на какой стадии был эпик и что было сделано.
- Предоставьте ссылку на главный файл-трекер `tasks.md`.

## Контрольный список проверки

- [ ] Определена текущая стадия эпика
- [ ] Для Стадии 1: Все вопросы `[НУЖНО УТОЧНИТЬ]` обработаны (либо заданы пользователю, либо переведены в исследовательские задачи)
- [ ] Для Стадии 2: Создан исследовательский план (`research.md`) с конкретными вопросами к кодовой базе
- [ ] Для Стадии 3: Созданы атомарные задачи с четкими критериями выполнения
- [ ] Создан главный трекер-файл `tasks.md` со списком всех задач, их статусов и зависимостей
- [ ] Все созданные файлы находятся в правильных директориях
- [ ] Коммуникация ведется на русском языке

---

## Статус выполнения

_Для `update_todo_list`_

- [ ] Файл эпика проанализирован, стадия определена
- [ ] Действия в соответствии со стадией выполнены
- [ ] Промежуточные артефакты созданы (`research.md`)
- [ ] Финальные задачи созданы (файлы в `/tasks/`)
- [ ] **Создан главный трекер-файл `tasks.md`**
- [ ] Контрольный список пройден

---

# Входные данные:

Имя эпика `<epic_name>` для декомпозиции.

## Выходные данные:

В зависимости от стадии:

1.  Обновленный файл `.context/epics/<epic_name>/epic.md`
2.  Файл исследования `.context/epics/<epic_name>/research.md`
3.  Набор задач в `.context/epics/<epic_name>/tasks/task_XXX.md`
4.  **Главный трекер-файл `.context/epics/<epic_name>/tasks.md`**

**ВАЖНЕЙШИЕ ПРАВИЛА:**

- Вся коммуникация и содержимое файлов должны быть на русском языке.
- Строго соблюдайте этапность. Не пропускайте стадии.
- **Файл `tasks.md` предназначен только для итоговых рабочих задач. Исследовательские задачи остаются в `research.md`.**
- Никогда не задавайте пользователю вопрос, если ответ может быть в коде.
- НИКОГДА не игнорируйте обратную связь пользователя.
- ОДИН ВОПРОС ЗА РАЗ. Используйте `ask_followup_decompose`.
- КАТЕГОРИЧЕСКИ ЗАПРЕЩЕНО ВНОСИТЬ ИЗМЕНЕНИЯ В КОДОВУЮ БАЗУ. Вы только планируете.
- Задачи должны быть краткими и лаконичными. Описывайте ЧТО нужно сделать, а не как нужно делать.
- Задачи должны быть расставлены в порядке приоритетности. Если одна задача зависит от другой задачи, это должно быть указано явно.
