---
description: "Адаптивное уточнение требований с определением сложности задачи"
---

# Определение и уточнение задачи (адаптивная версия)

## ОЦЕНКА НЕОБХОДИМОСТИ ЭТАПА

### Критерии пропуска этапа DEFINE
Данный этап ПРОПУСКАЕТСЯ если:
- [ ] Требования полностью определены и формализованы
- [ ] Критерии приёмки ясны и измеримы
- [ ] Область воздействия четко ограничена (≤3 файлов)
- [ ] Нет неопределенностей в техническом решении
- [ ] Есть точные аналоги в проекте

**ЕСЛИ ВСЕ УСЛОВИЯ ВЫПОЛНЕНЫ: ПЕРЕХОД К RESEARCH ИЛИ PLAN**

---

## АВТОМАТИЧЕСКОЕ ОПРЕДЕЛЕНИЕ СЛОЖНОСТИ

### Анализ входящего запроса
```
АЛГОРИТМ определения_сложности_задачи(описание_задачи):
    
    // Анализ ключевых слов
    тривиальные_индикаторы = ["изменить цвет", "исправить текст", "обновить конфигурацию"]
    простые_индикаторы = ["добавить поле", "новый компонент", "по аналогии"]
    средние_индикаторы = ["интеграция", "рефакторинг", "API", "валидация"]
    сложные_индикаторы = ["архитектура", "миграция", "аутентификация", "система"]
    
    // Анализ масштаба
    упоминания_файлов = извлечь_упоминания_файлов(описание_задачи)
    количество_компонентов = оценить_количество_компонентов(описание_задачи)
    
    // Анализ неопределенности
    вопросительные_слова = подсчитать_неопределенности(описание_задачи)
    
    ВОЗВРАТ интегральная_оценка_сложности()
```

### Матрица сложности задач

| Критерий | ТРИВИАЛЬНАЯ | ПРОСТАЯ | СРЕДНЯЯ | СЛОЖНАЯ |
|----------|------------|---------|---------|---------|
| **Файлы** | 1 | 2-3 | 4-10 | 10+ |
| **Неопределенности** | 0 | 1-2 | 3-5 | 5+ |
| **Технологии** | 1 | 1-2 | 2-3 | 3+ |
| **Зависимости** | Нет | Локальные | Модульные | Системные |
| **Аналоги** | Точные | Близкие | Частичные | Нет |

---

## АДАПТИВНЫЕ ПРОЦЕССЫ УТОЧНЕНИЯ

### РЕЖИМ 1: ЭКСПРЕСС (тривиальные задачи)
**Активируется если:** сложность = ТРИВИАЛЬНАЯ

**Процесс:**
1. **Подтверждение понимания** (1 итерация)
   - Переформулировать задачу одним предложением
   - Подтвердить файлы для изменения
   - Зафиксировать простые критерии приёмки

2. **Быстрая валидация**
   - Проверить наличие указанных файлов
   - Убедиться в отсутствии зависимостей

**Время:** 2-5 минут

### РЕЖИМ 2: СТАНДАРТНЫЙ (простые задачи)
**Активируется если:** сложность = ПРОСТАЯ

**Процесс:**
1. **Уточнение деталей** (2-3 итерации)
   - Основной функционал
   - Пользовательский интерфейс (если применимо)
   - Базовые критерии приёмки

2. **Поиск аналогов**
   - Найти похожие реализации в проекте
   - Подтвердить подход с пользователем

3. **Валидация требований**
   - Проверить полноту описания
   - Убедиться в технической реализуемости

**Время:** 5-15 минут

### РЕЖИМ 3: ДЕТАЛЬНЫЙ (средние задачи)
**Активируется если:** сложность = СРЕДНЯЯ

**Процесс:**
1. **Глубокое уточнение** (3-5 итераций)
   - Детальный функционал
   - Интеграционные требования
   - Требования к производительности
   - Ограничения и предположения

2. **Техническое исследование**
   - Анализ существующих решений
   - Выявление потенциальных подходов
   - Оценка рисков и ограничений

3. **Формализация требований**
   - Детальные критерии приёмки
   - Сценарии использования
   - Граничные условия

**Время:** 15-30 минут

### РЕЖИМ 4: КОМПЛЕКСНЫЙ (сложные задачи)
**Активируется если:** сложность = СЛОЖНАЯ

**Процесс:**
1. **Архитектурное планирование** (5-10 итераций)
   - Декомпозиция на подзадачи
   - Анализ влияния на систему
   - Требования к интеграции
   - Вопросы масштабирования

2. **Исследование решений**
   - Анализ индустриальных практик
   - Сравнение альтернативных подходов
   - Оценка технических рисков

3. **Детальная спецификация**
   - Полная техническая спецификация
   - Поэтапный план реализации
   - Критерии качества и производительности

**Время:** 30-60 минут

---

## УМНАЯ СИСТЕМА ВОПРОСОВ

### Динамическое формирование вопросов
```
ФУНКЦИЯ сформировать_следующий_вопрос(текущий_контекст, сложность_задачи):
    недостающие_детали = анализ_пробелов(текущий_контекст)
    приоритет_вопросов = определить_приоритеты(сложность_задачи)
    
    следующий_вопрос = выбрать_наиболее_важный(недостающие_детали, приоритет_вопросов)
    
    // Попытка автоматического ответа
    автоответ = поиск_в_кодовой_базе(следующий_вопрос)
    
    ЕСЛИ автоответ найден:
        ПРИМЕНИТЬ автоответ
        ПЕРЕЙТИ к следующему_вопросу
    ИНАЧЕ:
        ЗАДАТЬ следующий_вопрос пользователю
```

### Приоритизация вопросов по сложности

#### ТРИВИАЛЬНАЯ сложность:
1. Подтверждение понимания
2. Конкретизация результата

#### ПРОСТАЯ сложность:
1. Функциональные детали
2. Критерии приёмки
3. Предпочтения реализации

#### СРЕДНЯЯ сложность:
1. Архитектурные вопросы
2. Интеграционные требования  
3. Производительность и качество
4. Граничные случаи

#### СЛОЖНАЯ сложность:
1. Стратегические вопросы
2. Системная архитектура
3. Этапность реализации
4. Риски и ограничения
5. Долгосрочная поддержка

---

## АВТОМАТИЧЕСКИЙ ПОИСК АНАЛОГОВ

### Алгоритм поиска существующих решений
```
ФУНКЦИЯ найти_аналогичные_решения(описание_задачи, кодовая_база):
    ключевые_слова = извлечь_ключевые_слова(описание_задачи)
    
    // Поиск точных совпадений
    точные_аналоги = поиск_по_именам(ключевые_слова, кодовая_база)
    
    // Поиск функциональных аналогов
    функциональные_аналоги = поиск_по_функционалу(описание_задачи, кодовая_база)
    
    // Поиск паттернов
    архитектурные_паттерны = анализ_паттернов(кодовая_база)
    
    ВОЗВРАТ ранжированный_список_аналогов(точные, функциональные, паттерны)
```

### Интеграция найденных решений
```
ДЛЯ КАЖДОГО найденного_аналога:
    ЕСЛИ аналог точный:
        ПРЕДЛОЖИТЬ адаптацию существующего решения
    ИНАЧЕ ЕСЛИ аналог близкий:
        ПРЕДЛОЖИТЬ использование как основы
    ИНАЧЕ:
        ВКЛЮЧИТЬ в список примеров для изучения
```

---

## СТРУКТУРИРОВАННЫЙ ВЫВОД

### Шаблон файла задачи
```markdown
# Задача: [НАЗВАНИЕ]

## СТАТУС
- Сложность: [ТРИВИАЛЬНАЯ|ПРОСТАЯ|СРЕДНЯЯ|СЛОЖНАЯ]
- Режим уточнения: [ЭКСПРЕСС|СТАНДАРТНЫЙ|ДЕТАЛЬНЫЙ|КОМПЛЕКСНЫЙ]
- Статус: [УТОЧНЕНО]

## ОПИСАНИЕ ЗАДАЧИ
[Формализованное описание из исходного запроса]

## ТЕХНИЧЕСКАЯ ОБЛАСТЬ
- Затрагиваемые файлы: [список с обоснованием]
- Зависимые компоненты: [список]
- Технологии: [релевантный стек]

## ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ
[Детализированный список требований]

## КРИТЕРИИ ПРИЁМКИ
[Измеримые критерии успеха]

## НАЙДЕННЫЕ АНАЛОГИ
[Список существующих решений с оценкой применимости]

## ОГРАНИЧЕНИЯ И ПРЕДПОЛОЖЕНИЯ
[Технические и бизнес-ограничения]

## РЕКОМЕНДАЦИИ ДЛЯ СЛЕДУЮЩИХ ЭТАПОВ
- Необходимость RESEARCH: [ДА/НЕТ с обоснованием]
- Предлагаемый подход: [краткое описание]
- Критические области: [список для особого внимания]

## МЕТАДАННЫЕ
- Время уточнения: X минут
- Количество итераций: X
- Автоматически найденных аналогов: X
```

---

## САМОДОСТАТОЧНОСТЬ ПРОМПТА

### Минимальные требования для работы
- Описание задачи от пользователя (любой формат)
- Доступ к кодовой базе для поиска аналогов
- Базовые алгоритмы анализа текста (встроены)

### Алгоритм автономной работы
```
ЕСЛИ нет предыдущего контекста:
1. Загрузить минимальный контекст проекта
2. Применить автоматические алгоритмы анализа
3. Использовать эвристики для определения сложности
4. Работать в упрощенном режиме

ЕСЛИ недостаточно информации о проекте:
1. Сформировать вопросы на основе общих принципов
2. Использовать универсальные шаблоны
3. Сфокусироваться на функциональных требованиях
```

---

## КАЧЕСТВЕННЫЕ УЛУЧШЕНИЯ

### Механизм саморефлексии
```
ПЕРЕД завершением этапа:
1. Проверить полноту требований относительно сложности
2. Убедиться в наличии измеримых критериев приёмки
3. Валидировать техническую реализуемость
4. Оценить качество найденных аналогов

ЕСЛИ качество недостаточно:
    ПРОДОЛЖИТЬ уточнение с фокусом на слабые области
```

### Критерии качества определения задачи

#### ТРИВИАЛЬНАЯ задача:
- ✅ Понятен результат
- ✅ Известны файлы для изменения
- ✅ Есть простые критерии проверки

#### ПРОСТАЯ задача:
- ✅ Детализированы функциональные требования
- ✅ Найдены применимые аналоги
- ✅ Определены критерии приёмки
- ✅ Оценены риски

#### СРЕДНЯЯ задача:
- ✅ Проанализированы интеграционные аспекты
- ✅ Определены требования к производительности
- ✅ Исследованы альтернативные подходы
- ✅ Формализованы граничные условия

#### СЛОЖНАЯ задача:
- ✅ Декомпозирована на этапы
- ✅ Проанализировано влияние на архитектуру
- ✅ Оценены долгосрочные последствия
- ✅ Определена стратегия реализации

---

## ИНТЕГРАЦИЯ С WORKFLOW

### Рекомендации для следующих этапов
```
НА ОСНОВЕ сложности задачи И найденных аналогов:

ЕСЛИ сложность = ТРИВИАЛЬНАЯ И найдены точные аналоги:
    РЕКОМЕНДАЦИЯ: ПЕРЕЙТИ к IMPLEMENT (пропустить RESEARCH и PLAN)

ЕСЛИ сложность = ПРОСТАЯ И найдены близкие аналоги:
    РЕКОМЕНДАЦИЯ: ПЕРЕЙТИ к PLAN (пропустить RESEARCH)

ЕСЛИ сложность ≥ СРЕДНЯЯ ИЛИ аналоги отсутствуют:
    РЕКОМЕНДАЦИЯ: ВЫПОЛНИТЬ полный цикл RESEARCH → PLAN → IMPLEMENT
```

---

## МЕТРИКИ И ОБРАТНАЯ СВЯЗЬ

### Измеряемые показатели
- **Точность оценки сложности**: % корректных предсказаний
- **Полнота уточнения**: % задач, не требующих доуточнения
- **Эффективность поиска аналогов**: % полезных найденных решений
- **Время уточнения**: по режимам работы

### Автоматическое улучшение
- Корректировка весов алгоритма оценки сложности
- Обновление базы паттернов для поиска аналогов
- Оптимизация последовательности вопросов

---

## ЗАВЕРШЕНИЕ ЭТАПА

### Финальная валидация
- ✅ Задача формализована согласно уровню сложности
- ✅ Найдены и оценены применимые аналоги
- ✅ Критерии приёмки измеримы и достижимы
- ✅ Подготовлены рекомендации для оптимизации workflow
- ✅ Создан файл задачи в `.context/tasks/{date}/{task_name}/task_definition.md`

**ПЕРЕХОД к следующему этапу с формализованными требованиями**