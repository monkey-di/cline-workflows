---
description: "Рефакторинг и улучшение существующего кода"
---

# Рефакторинг кода

## Цель
Улучшить качество, читаемость и структуру существующего кода без изменения его внешнего поведения и функциональности.

## Входные данные
- Описание области для рефакторинга от пользователя
- Конкретные файлы или компоненты для улучшения
- Проблемы в коде, которые нужно исправить

## Процесс

### Шаг 1: Анализ текущего кода
1. **Изучение области рефакторинга:**
   - Прочитай указанные файлы или компоненты
   - Пойми текущую логику и структуру
   - Определи назначение каждой части кода

2. **Выявление проблем:**
   - Дублирование кода
   - Сложная или запутанная логика
   - Длинные функции или классы
   - Неясные названия переменных/функций
   - Нарушение принципов SOLID

3. **Анализ зависимостей:**
   - Найди, где используется рефакторируемый код
   - Определи внешние интерфейсы, которые нужно сохранить
   - Изучи тесты, если они есть

### Шаг 2: Планирование улучшений
1. **Определение целей:**
   - Что именно нужно улучшить
   - Какие принципы применить
   - Какую структуру получить в результате

2. **Приоритизация изменений:**
   - Начни с безопасных улучшений
   - Сначала убери дублирование
   - Затем улучши читаемость
   - В конце оптимизируй структуру

### Шаг 3: Поэтапное выполнение
1. **Мелкие безопасные изменения:**
   - Переименование переменных и функций
   - Форматирование и стиль кода
   - Удаление неиспользуемого кода
   - Добавление комментариев

2. **Извлечение функций и компонентов:**
   - Выдели повторяющиеся блоки в отдельные функции
   - Создай utility-функции для общих операций
   - Разбей длинные функции на более мелкие

3. **Улучшение структуры:**
   - Реорганизуй логику для лучшей читаемости
   - Примени паттерны проектирования где уместно
   - Улучши обработку ошибок

### Шаг 4: Проверка результата
1. **Функциональная проверка:**
   - Убедись, что поведение кода не изменилось
   - Протестируй основные сценарии использования
   - Проверь граничные случаи

2. **Качество кода:**
   - Код стал более читаемым
   - Устранено дублирование
   - Улучшена структура и организация

## Принципы качественного рефакторинга

### Безопасность изменений:
- **Сохраняй внешний интерфейс** - публичные методы и их сигнатуры
- **Не меняй поведение** - функциональность должна остаться той же
- **Небольшие шаги** - делай маленькие изменения и проверяй результат

### Улучшение читаемости:
- **Осмысленные имена** - переменные и функции должны отражать назначение
- **Простая логика** - избегай сложных вложенных условий
- **Комментарии** - объясняй сложную бизнес-логику

### Структурные улучшения:
- **Единственная ответственность** - каждая функция должна делать одно дело
- **DRY принцип** - убирай дублирование кода
- **Консистентность** - следуй установленным в проекте паттернам

## Типичные виды рефакторинга

### Извлечение функций:
```javascript
// До
function processUser(user) {
    // валидация
    if (!user.email || !user.name) return false;
    
    // обработка
    user.email = user.email.toLowerCase();
    user.name = user.name.trim();
    
    // сохранение
    database.save(user);
}

// После
function processUser(user) {
    if (!validateUser(user)) return false;
    const cleanUser = cleanUserData(user);
    saveUser(cleanUser);
}
```

### Упрощение условий:
```javascript
// До
if (user.role === 'admin' || user.role === 'moderator' || user.role === 'editor') {
    // логика
}

// После
const canEdit = ['admin', 'moderator', 'editor'].includes(user.role);
if (canEdit) {
    // логика
}
```

### Удаление дублирования:
```javascript
// До - дублирующийся код в нескольких местах

// После - общая функция
function formatCurrency(amount) {
    return new Intl.NumberFormat('ru-RU', {
        style: 'currency',
        currency: 'RUB'
    }).format(amount);
}
```

## Области для рефакторинга

### Frontend компоненты:
- Большие компоненты разбить на мелкие
- Вынести логику в custom hooks или composables
- Улучшить управление состоянием

### Backend логика:
- Разделить бизнес-логику и работу с данными
- Создать сервисные слои
- Улучшить обработку ошибок

### Утилиты и хелперы:
- Создать переиспользуемые функции
- Организовать в логические модули
- Добавить типизацию

## Критерии завершения
- ✅ Код стал более читаемым и понятным
- ✅ Устранено дублирование
- ✅ Функциональность сохранена
- ✅ Улучшена структура и организация
- ✅ Код соответствует стандартам проекта
- ✅ Проведено тестирование изменений

## Результат
Улучшенный код, который легче читать, понимать и поддерживать, но работает точно так же, как и раньше.