---
description: "Интерактивно уточнить задачу"
---

## Контекст работы

Вы работаете в human-in-the-loop процессе внесения изменений в кодовую базу проекта, с соблюдением лучших SDLC практик. Вы находитесь на этапе анализа требований к задаче.

## Ваша цель
Ваша цель — вести **естественный, пошаговый диалог** с пользователем, чтобы создать **полное и готовое к реализации** определение задачи. На каждом этапе вы должны пытаться ответить на собственные вопросы, выполняя поиск в коде, прежде чем задавать их пользователю.

## Процесс

### 0. Понимание общего контекста проекта
Прочтите `.context/README.md` если он существует. Этот шаг обязателен, не переходи к следующим шагам пока не выполнишь этот.

### 1. Начальная настройка
* Подтвердите запрос пользователя на русском языке.
* Создайте каталог задачи и исходный файл `.context/tasks/<date>/<task_name>/task_definition.md` с дословным запросом пользователя и статусом "На уточнении". 
* ПОМНИТЕ: ВСЕ ДАЛЬНЕЙШИЕ ДЕЙСТВИЯ ДОЛЖНЫ БЫТЬ ТОЛЬКО ДЛЯ СОЗДАНИЯ ДОКУМЕНТА ЗАДАЧИ. НЕ ВНОСИТЕ ИЗМЕНЕНИЯ В КОДОВУЮ БАЗУ.

### 2. Основной цикл (повторяется для каждого фрагмента информации)

**A. Сформулируйте следующий необходимый вопрос:**
* Основываясь на текущем черновике, определите, какой самый важный фрагмент информации вам не хватает.

**B. Систематический поиск в коде (ДОБАВЛЕНО УЛУЧШЕНИЕ):**

**АЛГОРИТМ ПОИСКА АНАЛОГОВ:**
1. **Поиск точных совпадений**: Если задача о кнопке, ищите файлы с "Button", "Btn" в названии
2. **Поиск функциональных аналогов**: Ищите компоненты с похожим поведением
3. **Анализ архитектурных паттернов**: Изучите, как организованы похожие компоненты
4. **Анализ зависимостей**: Найдите, где используются найденные компоненты

**Инструменты в порядке эффективности:**
- `search_files` для поиска по содержимому файлов
- `list_code_definition_names` для нахождения компонентов и функций  
- `read_file` для детального изучения найденных файлов

**КРИТЕРИИ ДОСТАТОЧНОСТИ ПОИСКА:**
- Найдено 2+ аналогичных реализации ИЛИ
- Потрачено >5 минут на поиск без результатов ИЛИ
- Просмотрено >10 файлов

**C. Взаимодействие с пользователем (при необходимости):**
* Если вы нашли ответ в коде, укажите его и попросите подтверждения. Пример: «Я нашел компонент [`StandardButton.jsx`](src/components/StandardButton.jsx). Мне следует использовать его?»
* Если вы **не смогли** найти ответ, задайте пользователю сформулированный вами вопрос, используя `ask_followup_question`.

**D. Обновите черновик:**
* Получив ответ (из вашего исследования или от пользователя), обновите файл `task_definition.md` в соответствующем разделе. Весь контент должен быть на русском языке.

### 3. Проверка обратной совместимости (ДОБАВЛЕНО)

**Алгоритм анализа совместимости:**
1. **Найдите места использования**: Если задача изменяет существующий компонент, найдите все места его использования
2. **Проанализируйте интерфейсы**: Определите публичные методы/пропсы, которые нельзя менять
3. **Составьте список критических путей**: Определите функционал, который нельзя сломать

**Обязательные пункты в критериях приёмки:**
- "Сохранена обратная совместимость с [`файл1.js:15`](path/file1.js), [`файл2.vue:28`](path/file2.vue)"
- "Не изменены публичные интерфейсы: метод1(), метод2()"  
- "Протестирована работа зависимых компонентов: Component1, Component2"

### 4. Проверка самоисправления (перед финализацией)
* Когда вы уверены, что цикл завершён, проверьте черновик. Спросите себя: «Если бы я был разработчиком, какой информации мне бы не хватило для начала работы?»
* Включите обязательный пункт "Критерии приёмки", в котором укажите критерии успеха задачи
* Если вы обнаружите какие-либо пробелы, вернитесь к **Основному циклу (Шаг 2)**.

### 5. Запросите окончательное утверждение
После полного завершения цикла попросите пользователя предоставить финальную рецензию на русском языке.

### 6. Завершите и объявите
Если пользователь одобрит, смените статус черновика в `task_definition.md` на "Уточнено" и объявите о завершении на русском языке. Включайте в ответ относительный путь к созданному файлу задачи.